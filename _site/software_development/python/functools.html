<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>saubhik | Personal cyber-space dump.</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="saubhik" />
<meta name="author" content="Saubhik Mukherjee" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Personal cyber-space dump." />
<meta property="og:description" content="Personal cyber-space dump." />
<link rel="canonical" href="http://localhost:4000/software_development/python/functools.html" />
<meta property="og:url" content="http://localhost:4000/software_development/python/functools.html" />
<meta property="og:site_name" content="saubhik" />
<script type="application/ld+json">
{"description":"Personal cyber-space dump.","author":{"@type":"Person","name":"Saubhik Mukherjee"},"@type":"WebPage","url":"http://localhost:4000/software_development/python/functools.html","headline":"saubhik","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=7f90a6ed2a8ee84cfa7f3ceb5a300c7e86b460f3">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/">saubhik</a></h1>

        

        <p>Personal cyber-space dump.</p>

        <p class="view"><a href="https://github.com/saubhik/">View my GitHub profile<small>github.com/saubhik</small></a></p>
        <p class="view"><a href="/posts.html">Blog<small>/posts</small></a></p>

        

        <a href="/index.html">Home</a>
</br><a href="/papers/">Comments on deep learning papers</a>
</br><a href="/epi/">Elements Of Programming Interviews</a>
</br><a href="/software_development/">Software Development</a>
</br><a href="/utilities/">Utilities</a>
</br><a href="/data_science/">Data Science</a>
</br><a href="/notebooks/">Jupyter Notebooks</a>
</br><a href="/deep_learning/">Deep Learning</a>
</br><a href="/coursework/index.html">CS courses notes</a>
</br><a href="/this_site/">About this website</a>
</br><a href="/practice-javascript/">Practice Javascript</a>


      </header>
      <section>

      <h4 id="functools---tools-for-manipulating-functions">functools - tools for manipulating functions</h4>

<p>First, let’s import functools.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">functools</span>
</code></pre></div></div>

<p>There is something called <code class="highlighter-rouge">partial</code>. This is a class. Let’s see what this does.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s">"Docstring for my_func"</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' called my_func with:'</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</code></pre></div></div>

<p>Okay that is a some function. Whenever someone calls it, it will print something. Let’s see
where this is going. Let’s move on to the next function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">is_partial</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">"Show details of a callable object"</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' object:'</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_partial</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' __name__:'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_partial</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' func:'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' args:'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' keywords:'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></div>

<p>So that was some function. Let’s see how it works.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show_details</span><span class="p">(</span><span class="s">'my_func'</span><span class="p">,</span> <span class="n">my_func</span><span class="p">)</span>
</code></pre></div></div>

<p>Okay, so it printed this:</p>

<pre><code class="language-commandline">my_func:
 object: &lt;function my_func at 0x7f92d5c05510&gt;
 __name__: my_func
</code></pre>

<p>Now let’s try some more code.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s">'partial with named default'</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>I got this now:</p>

<pre><code class="language-commandline">partial with named default:
 object: functools.partial(&lt;function my_func at 0x7f92d5c05510&gt;, b=4)
 func: &lt;function my_func at 0x7f92d5c05510&gt;
 args: ()
 keywords: {'b': 4}
</code></pre>

<p>Now <code class="highlighter-rouge">p1</code> is a function. It is actually a <code class="highlighter-rouge">partial</code> object:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span><span class="p">(</span><span class="s">'passing a'</span><span class="p">)</span>
<span class="n">p1</span><span class="p">(</span><span class="s">'override b'</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<p>which gives:</p>

<pre><code class="language-commandline"> called my_func with: ('passing a', 4)
 called my_func with: ('override b', 5)
</code></pre>

<p>Good. Now let’s set a partial with both default values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="s">'default a'</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s">'partial with defaults'</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>This gives the following output:</p>

<pre><code class="language-commandline">partial with defaults:
 object: functools.partial(&lt;function my_func at 0x7f92d5c05510&gt;, 'default a', b=99)
 func: &lt;function my_func at 0x7f92d5c05510&gt;
 args: ('default a',)
 keywords: {'b': 99}
</code></pre>

<p>Okay, so now I get the idea. I can pass some default values to function arguments using <code class="highlighter-rouge">functools.partial</code>. But this
can also be done easily without using <code class="highlighter-rouge">functools.partial</code>. The main thing is that I can over-ride the default values
of the arguments in the function. So I can create a host of new functions from the existing function, by using different
default values for the arguments.</p>

<p>Now, these <code class="highlighter-rouge">functools.partial</code> objects do not have <code class="highlighter-rouge">__name__</code> or <code class="highlighter-rouge">__doc__</code> attributes by default and it seems that these
decorated functions now become difficult to debug without these attributes. Using <code class="highlighter-rouge">update_wrapper()</code> copies these
attributes from the original functions to the <code class="highlighter-rouge">partial</code> objects.</p>

<p>Consider the following snippet:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s">"""Show details of a callable object."""</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' object:'</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' name:'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' name:'</span><span class="p">,</span> <span class="s">'(no __name__)'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' __doc__'</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    
<span class="n">show_details</span><span class="p">(</span><span class="s">'my_func'</span><span class="p">,</span> <span class="n">my_func</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s">'wrapper'</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
</code></pre></div></div>

<p>This shows me:</p>

<pre><code class="language-commandline">my_func
 object: &lt;function my_func at 0x7f92d5c05510&gt;
 name: my_func
 __doc__ Docstring for my_func
wrapper
 object: functools.partial(&lt;function my_func at 0x7f92d5c05510&gt;, b=5)
 name: (no __name__)
 __doc__ partial(func, *args, **keywords) - new function with partial application
    of the given arguments and keywords.
</code></pre>

<p>Now, if I use <code class="highlighter-rouge">update_wrapper</code>, using like <code class="highlighter-rouge">functools.update_wrapper(p1, my_func)</code>. Then our wrapper <code class="highlighter-rouge">p1</code> will have the
concerned attributes <code class="highlighter-rouge">__name__</code> and <code class="highlighter-rouge">__doc__</code> from the original function <code class="highlighter-rouge">my_func</code>.</p>

<p>Now, let’s delve deeper.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">simple_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">'decorated defaults'</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' decorated:'</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>
    
    
<span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s">"""my_func() is not complicated"""</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' my_func:'</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span>


<span class="nd">@simple_decorator</span>
<span class="k">def</span> <span class="nf">decorated_my_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="s">"""This is docstring."""</span>
    <span class="n">my_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></div>

<p>Okay, so we see that <code class="highlighter-rouge">functools.wraps</code> automatically applies the <code class="highlighter-rouge">update_wrapper()</code> which applies the attributes of the
original function to the decorated function.</p>

<p>That’s it for now.</p>


      </section>
      <footer>
        <p><small>Love &mdash; Peace &mdash; Code</small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
  </body>
</html>